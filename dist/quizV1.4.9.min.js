function quizWidget(_){var r=_("[data-quiz-config]").data("quizConfig"),d=[],e={options:{mobileBreakpoint:768,getStartedButtonClass:"quiz-widget__get-started-button",getStartedContainerClass:"quiz-widget__get-started",getFooterContainerClass:"quiz-widget__footer",getStartedText:r.getStartedText||"Not sure which bed you need? Take our quick Sleep Selector quiz and we'll recommend the right bed for you.",getStartedTextFirstParagraph:r.getStartedTextFirstParagraph||"Embarking on a journey towards perfect sleep begins with choosing the right mattress, a task made simpler with Sleepyhead's Sleep Selector. This innovative tool asks insightful questions about your sleeping habits and preferences, guiding you to a personalised Sleepyhead bed recommendation.",getStartedTextSecondParagraph:r.getStartedTextSecondParagraph||"Through this tailored approach, finding your perfect sleep solution turns your dreams into reality.",getStartedTextThirdParagraph:r.getStartedTextThirdParagraph||"Why the right mattress is key to a good sleep",getStartedTextFourthParagraph:r.getStartedTextFourthParagraph||"Finding the right mattress is a cornerstone of achieving optimal sleep, impacting everything from our physical well-being to our mental health. It serves not just as a platform for rest but as a tool for enhancing the quality of our sleep. A suitable mattress adapts to the contours of the body, providing support where it's needed most. Sleepyhead embodies the belief that the right mattress is essential for a better quality of life.",quizTabs:"#quiz-tabs",questionTitle:".qp_qi",questionPicture:".qp_pic",learnMoreClass:"quiz-widget__learn-more",quizResults:"#quiz-results",quizContainer:".quiz-container",quizWrapper:".quiz-widget__wrapper",progressBarWrapperClass:"quiz-widget__progress-bar-wrapper",progressBar:".quiz-widget__progress-bar",progressLine:".quiz-widget__progress-line",progressBarItems:".quiz-widget__progress-bar-item",leadsDataStorageKey:"leads-data",formQuestionsClass:"quiz-widget__send-results-questions",formWrapperClass:"quiz-widget__send-results-wrapper",formSubmitButtonClass:"quiz-widget__send-results-submit",formCloseButtonClass:"quiz-widget__send-results-close",solutionLinksTrigger:".quiz-widget__solution-links__trigger, .quiz-widget__solution-links__close",solutionLinksWrapper:".quiz-widget__solution-links__wrapper",solutionLink:".quiz-widget__solution-link",solutionShift:".quiz-widget__solution-shift",reviewsPageSwitcher:".reviews-page__switch-page",leadGenPlaceholder:r.leadGenPlaceholder||"Tell us in 300 characters or less why you should win and what you would buy with the $5000 Prezzee Gift Card."},_loadQuiz:function(){var s=this;qz.setKey(r.publicKey),qz.load({quiz:r.quizId,parent:r.quizParent,onCreate:function(e){s.questions=e.schema.questions,quiz.scrollTo=()=>{},quiz.xSend=function(e,t,i){return!!e&&!!e.d&&0<_("#quiz-ntabs").length&&s._setLeadsDataToStorage(e),document.qzScript?qz.xSend(e,t,i):xSend(e,t,i)},quiz.setErr=function(e,t){var i,s=quiz.obj(".take-q[qid='"+e+"']",2);s&&(quiz.scrolltabs?quiz.scrollToTab(s.parentNode.idx):((i=quiz.tbox.style).overflow="visible",i.overflow=""),s.setAttribute("err",1),quiz.msgL[0]&&quiz.obj(".take-q[qid='"+e+"'] > SPAN:last-of-type",2).setAttribute("emsg",quiz.msgL[0]),t)&&t.focus&&t.focus()},s._init()}})},_buildLoadEmailMeResultsPopup:function(){var n,e=localStorage.getItem(this.options.leadsDataStorageKey),e=e&&JSON.parse(e);e&&(this.leadsObject=e,e=this._getLeadsQuestions(e.d),n="",_.each(e,function(e,t){var i,s,r,a;console.log(t.question),t.question.includes("terms-and-conditions")||t.question.includes("Terms and Conditions")||t.question.includes("Tell us")||(i="text","Email"===t.format&&(i="email"),"Number"===t.format&&(i="number"),r=(s="checkbox"===(i="Checkboxes"===t.type?"checkbox":i))?'<label for="'+t.id+'">'+t.question+"</label>":"",a=s?"":t.question,n+='<div class="'+(s?"quiz-widget__send-results-question  checkbox":"quiz-widget__send-results-question")+'" data-id="'+t.id+'"><div class="'+(s?"quiz-widget__send-results-question-control  checkbox":"quiz-widget__send-results-question-control")+'"><input id="'+t.id+'" type="'+i+'" placeholder="'+a+'"></div>'+r+"</div>")}),e=_('<div class="'+this.options.formWrapperClass+'" style="display: none"><div class="quiz-widget__send-results"><button class="'+this.options.formCloseButtonClass+'"></button><div class="quiz-widget__send-results-title">Get your results in your inbox</div><div class="quiz-widget__send-results-subtitle">Thanks for completing the Sleep Selector. Enter in your details below and we’ll email you your results straight to your inbox.</div><div class="'+this.options.formQuestionsClass+'">'+n+'</div><button class="'+this.options.formSubmitButtonClass+'">submit</button></div></div>'),_("#quiz").append(e),(e=_('input[placeholder="Lead Capture Form Flag"]')).length)&&(e.parent().parent().hide(),e.val("resultform"))},_sendForm:function(){var e=this.options,e=_("."+e.formQuestionsClass+" [data-id]");if(this._validateForm(e)){var t,n=this.decodedJson,i=(n.ans=n.ans.split("Ñ")[0],_.each(e,function(e,t){var t=_(t),i=t.data("id"),t=t.find("input"),s="checkbox"===t.attr("type"),r=t.val(),a="";a=s?"Ñ"+i+"¦"+(r=t.is(":checked")?"1":"")+"¦":"Ñ"+i+"¦999¦"+r,d[i]=r,n.ans+=a}.bind(this)),[]);for(t in n)n.hasOwnProperty(t)&&("track"===t&&(d.id=n[t]),i.push(encodeURIComponent(t)+"="+encodeURIComponent(n[t])));d.isOdRequest=!0;var s,r=[];for(s in d)r.push(encodeURIComponent(s)+"="+encodeURIComponent(d[s]));i.join("&");this._sendRequest(r).then(function(){this._triggerFormVisibility(!1),_("."+this.options.formSubmitButtonClass).prop("disabled",!1)}.bind(this),function(e){this._triggerFormVisibility(!1),_("."+this.options.formSubmitButtonClass).prop("disabled",!1)}.bind(this))}},_sendRequest:async function(e){_("."+this.options.formSubmitButtonClass).prop("disabled",!0),fetch(r.webhookUrl+"?"+e.join("&"),{mode:"no-cors"})},_validateForm:function(e){var n=!0,o="Incorrect form input";return _.each(e,function(e,t){var t=_(t),i=t.data("id"),t=t.find("input"),s=t.attr("type"),r="email"===s,s="checkbox"===s,a=t.val();return o="",12748425==+i||13709975==+i||(o=r?(d.email=a,"Please provide correct email address"):s?"please select: "+this.questions["Q"+i].question:this.questions["Q"+i].question+" is required",n=s?!!t.is(":checked"):r?/(.+)@(.+){2,}\.(.+){2,}/.test(a):!!a)}.bind(this)),n||quiz.msg(o),n},_getLeadsQuestions:function(e){return this.decodedJson=JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'),this.decodedJson.ans.split("Ñ").filter(function(e){e=e.split("¦");return 1<e.length&&e}).map(function(e){var e=e.split("¦"),t="Q"+e[0],t=this.questions[t];return t.savedAnswer=e[2],t.id=e[0],t}.bind(this))},_setLeadsDataToStorage:function(e){localStorage.setItem(this.options.leadsDataStorageKey,JSON.stringify(e))},_create:function(){r.publicKey&&r.quizParent&&r.quizId&&(this._loadQuiz(),quiz.addCB("afterResults",function(){this._processLeads(),this.quizTime&&(clearTimeout(this.quizTime),this.quizTime=null),_(this.options.quizContainer).toggleClass("results",this._isResultsStep()),this._triggerProgressBarVisibility(!1),this._removeBaseStyles(),this._isResultsStep()?(this._fixTitle(),this._buildLoadEmailMeResultsPopup(),this._loadReviews(),this.pushFormDataToDataLayer(),localStorage.getItem("reloadedresults")||_("html, body").animate({scrollTop:0},"fast"),localStorage.setItem("reloadedresults",!0)):localStorage.removeItem("reloadedresults")}.bind(this)),quiz.addCB("Next",function(e){this._updateProgressBar(e.frompage+1)}.bind(this)),quiz.addCB("Back",function(e){this._updateProgressBar(e.frompage-1)}.bind(this)))},_fixTitle:function(){var e=_('.quiz-widget__solution-sub-heading[data-subtitle="feel"]'),t=_('.quiz-widget__solution-sub-heading[data-subtitle="size"]'),i=e.text().toLowerCase().replaceAll("it varies","medium");"Feel:"===e.text().trim()||e.text().toLowerCase().includes("not sure")?e.remove():e.text(i),"Size:"!==t.text().trim()&&!t.text().toLowerCase().includes("not sure")||t.remove()},digestMessage:async function(e){e=(new TextEncoder).encode(e),e=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")},pushFormDataToDataLayer:async function(){window.dataLayer.push({event:"completed_sleep_selector",sleep_selector_recommendation:_(".quiz-widget__solution-heading").text()});var t=window.qz.data[Object.keys(window.qz.data)[0]].qObj.schema.questions;if(0<Object.keys(t).filter(e=>{e=t[e];return"Email address"===e.question&&e.savedAnswer}).length){var e,i={event:"submitted_competition_form"};for(e in Object.values(t)){var s=Object.values(t)[e],r=s&&s.savedAnswer&&s.savedAnswer.trim()?s.savedAnswer:"";switch(s.question){case"First name":i.first_name=r,i.fn=r?await this.digestMessage(r):"";case"Last name":i.last_name=r,i.ln=r?await this.digestMessage(r):"";case"Email address":i.email=decodeURIComponent(r),i.em=r?await this.digestMessage(r):"";case"Phone number":var a=r.replace(/[^\d\+]/g,"");i.phone=a,i.ph=a?await this.digestMessage(a):""}s.question&&-1!==s.question.indexOf("tips")&&(i.email_optin=!!s.answers[0].answer)}window.dataLayer.push(i)}else window.dataLayer.push({event:"skipped_competition_form"})},getSelectedQuestionData:function(e){var t=e-1,i=_(this.options.quizTabs+"> div"),s=i.length,i=i.eq(t),t=i.find(".qp_qi > div").eq(0).text(),i=i.find("[sel=1]");i.parents(".qp_flexc").index();return{event:"answered_sleep_selector",sleep_selector_step:`Question ${e} of `+s,sleep_selector_question:t,sleep_selector_answer:i.find(".qp_t").text()}},_loadReviews:function(){var e,t;r.reviewsPublicKey&&((e=document.createElement("script")).type="text/javascript",e.async=!0,e.src="//staticw2.yotpo.com/"+r.reviewsPublicKey+"/widget.js",(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t))},_processLeads:function(){_("#quiz-ntabs").length&&(this._processFlagLeadFormData(),this._replacePlaceholders(),this._replaceButtons(),this._setEventListenersOnLeads())},_setEventListenersOnLeads:function(){_("textarea[maxlength]").on("keyup",function(){var e=+_(this).attr("maxlength"),t=this.value.length;e&&e<=t&&quiz.msg("Maximum characters length is "+e)})},_processFlagLeadFormData:function(){var e=_("#quiz-ntabs").find(this.options.questionTitle),i=null;_.each(e,function(e,t){"Lead Capture Form Flag"==_(t).text()&&((t=_(t).parent().parent()).hide(),(i=t.find("input")).length)&&(t=window.location.href.split("#"),i.attr("flagleadform",1),i.val("leadform"+t[1]))})},_replacePlaceholders:function(){var e,t=[{old:"Enter number here",new:"Phone number"},{old:"First Name",new:"First name"},{old:"Last Name",new:"Last name"},{old:"Email",new:"Email address"},{old:"Enter text here",new:this.options.leadGenPlaceholder,maxlength:"300"}];for(e in t){var i=t[e],s=_('input[placeholder="'+i.old+'"], textarea[placeholder="'+i.old+'"]');s.length&&s.attr("placeholder",i.new),s.length&&i.maxlength&&s.attr("maxlength",i.maxlength)}},_replaceButtons:function(){_("#quiz-end input").val("Submit"),_("#quiz-skip input").val("No thanks, show me my results")},_updateProgressBar:function(e){var t=this._getTabs(),e=e||+t.siblings(".sel").attr("tid"),t=+t.eq(e-1).attr("data-index"),e=_(this.options.progressBarItems),i=(t-1)/+e.length*100,i=(_(this.options.progressLine).css({width:i+"%"}),e.removeClass("active"),_(this.options.progressBarItems+'[data-index="'+t+'"]')),e=i.offset();i.addClass("active"),e&&_(this.options.progressBar).stop().animate({scrollLeft:e.left-20},500)},_isResultsStep:function(){return 0<_(this.options.quizResults).length},_init:function(){this._prepareWidget(),this._initEvents()},_prepareWidget:function(){this._applyStyles(),this._isQuizInProgress()?this._beginQuiz():(this._createGetStarted(),this._updateQuestionsHtml())},_isQuizInProgress:function(){var e=r.quizId.substring(1);return-1!==window.location.hash.indexOf(e)},_applyStyles:function(){var e=r.styles;this._removeBaseStyles(),e?((e=_("<link/>",{rel:"stylesheet",type:"text/css",href:e})).on("load",function(){this._triggerQuizWrapperVisibility(!0)}.bind(this)),e.appendTo(this._getWrapper())):this._triggerQuizWrapperVisibility(!0)},_removeBaseStyles:function(){this._getParent().find("link").remove(),_(".qp_quiz").attr("style","")},_getParent:function(){return _("#"+r.quizParent)},_getWrapper:function(){return _("."+r.quizWrapper)},_getTabs:function(){return _(this.options.quizTabs+">div")},_gatTabsFilteredLength:function(){var e=this._getTabs(),r=this.options,a=0;return _.each(e,function(e,t){var t=_(t),i=t.prev(),s=t.find(r.questionTitle).find("code").data("progressbar");i.length&&0<i.find(r.questionTitle+" code[data-progressbar="+s+"]").length||a++,this._setTabIndex(t,a)}.bind(this)),a},_setTabIndex:function(e,t){e.attr("data-index",t)},_updateQuestionsHtml:function(){var p,e=this._getTabs(),h=this.options,m=this._gatTabsFilteredLength();m&&(p=_('<div style="display: none" class="'+h.progressBarWrapperClass+'"><div class="quiz-widget__progress-line-wrapper"><div class="quiz-widget__progress-line"></div></div><div class="quiz-widget__progress-bar"></div></div>'),_.each(e,function(e,t){var t=_(t),i=t.find(h.questionTitle),s=i.find("code"),r=s.data("title"),a=s.data("text"),s=s.data("progressbar"),n=t.data("index"),o=_('<div class="quiz-widget__question-index-of-total-text">Question '+n+" of "+m+"</div>"),d=t.find(h.questionPicture),u=d.css("background-image"),l=_('<button class="quiz-widget__learn-more-open"></button>'),c=_('<button class="quiz-widget__learn-more-close"></button>'),g="quiz-widget__learn-more-holder",r=_('<div style="display: none" class='+this.options.learnMoreClass+'><div class="'+g+'"><div class="quiz-widget__learn-more-column quiz-widget__learn-more-column--info"><h3>'+r+'</h3><div class="quiz-widget__learn-more-text">'+a+'</div></div><div class="quiz-widget__learn-more-column quiz-widget__learn-more-column--image"><div class="quiz-widget__learn-more-image"></div></div></div></div>');d.remove(),r.find("."+g).append(c),i.find(">div:first-child").append(l),o.insertBefore(i),t.append(r),s&&p&&(0<p.find('[data-index="'+n+'"]').length||p.find(".quiz-widget__progress-bar").append('<div class="quiz-widget__progress-bar-item" data-index="'+n+'">'+s+"</div>")),r.find(".quiz-widget__learn-more-image").css("background-image",u),c.on("click",function(){this._triggerLearnMoreVisibility(!1)}.bind(this)),l.on("click",function(){this._triggerLearnMoreVisibility(!0)}.bind(this))}.bind(this)),_("."+h.progressBarWrapperClass).remove(),_(h.quizWrapper).prepend(p))},_createGetStarted:function(){var e="Quiz time: "+r.quizTimeMinutes+" minutes",e="<div class="+this.options.getStartedContainerClass+'><h3>Sleep Selector</h3><div class="quiz-widget__quiz-time">'+e+'</div><div class="quiz-widget__get-started-text quiz-widget__get-first-paragraph-text">'+this.options.getStartedTextFirstParagraph+'</div><div class="quiz-widget__get-started-text quiz-widget__get-second-paragraph-text">'+this.options.getStartedTextSecondParagraph+'</div><div class="quiz-widget__get-started-text quiz-widget__bold">'+this.options.getStartedText+"</div><button class="+this.options.getStartedButtonClass+">Get started</button></div>",t="<div class="+this.options.getFooterContainerClass+'><div class="quiz-widget__footer quiz-widget__get-third-paragraph-text">'+this.options.getStartedTextThirdParagraph+'</div><div class="quiz-widget__get-started-text quiz-widget__get-fourth-paragraph-text">'+this.options.getStartedTextFourthParagraph+"</div>";_("."+this.options.getStartedContainerClass).remove(),_("."+r.quizWrapper).prepend(e),_("#quiz-widget-footer").prepend(t)},_initEvents:function(){var e=this.options;_("."+e.getStartedButtonClass).on("click",function(){this._beginQuiz(),this._setQuizTime()}.bind(this)),_(document).off("click",".quiz-lc #quiz-next"),_(document).on("click",".quiz-lc #quiz-next",function(e){setTimeout(function(){quiz.saveQ("E")},500)}.bind(this)),_(document).on("click",this.options.quizTabs+" .qp_flexc",function(e){e=_(e.currentTarget).parents(".take-q").parent().attr("tid"),e=this.getSelectedQuestionData(e),e=_.extend(e,{event:"selected_answer"});window.dataLayer=window.dataLayer||[],window.dataLayer.push(e)}.bind(this)),_(document).on("click","."+e.learnMoreClass,function(e){e=_(e.target);e.is(".quiz-widget__learn-more-holder")||0<e.parents(".quiz-widget__learn-more-holder").length||this._triggerLearnMoreVisibility(!1)}.bind(this)),_(document).on("click","."+e.formWrapperClass,function(e){e=_(e.target);e.is(".quiz-widget__send-results")||0<e.parents(".quiz-widget__send-results").length||this._triggerFormVisibility(!1)}.bind(this)),_(document).one("click",".quiz-lc #quiz-back",function(){window.location.hash="",this._reloadQuiz()}.bind(this)),_(document).on("click",".quiz-widget__email-results-button",function(){this._triggerFormVisibility(!0)}.bind(this)),_(document).on("click",".quiz-widget__warranty-button",function(e){var e=_(e.target),t=e.hasClass("next"),e=e.siblings(".quiz-widget__warranty-holder"),i=e.find(".quiz-widget__warranty-item"),e=e.find(".active"),s=e[t?"next":"prev"]();e.removeClass("active"),(0<s.length?s:i[t?"first":"last"]()).addClass("active")}),_(document).on("click","."+this.options.formSubmitButtonClass,this._sendForm.bind(this)),_(document).on("click","."+this.options.formCloseButtonClass,function(){this._triggerFormVisibility(!1)}.bind(this)),_(document).on("click",this.options.solutionLinksTrigger,function(e){_(e.currentTarget).parents(this.options.solutionLinksWrapper).toggleClass("active")}.bind(this)),_(document).on("click",this.options.solutionLink,function(e){var t=_(e.currentTarget),i=t.attr("href");window.innerWidth<=this.options.mobileBreakpoint&&"sleepMaker"===r.projectName&&(e.preventDefault(),_(this.options.solutionLink).removeClass("active"),t.addClass("active"),_(this.options.solutionShift).attr("href",i))}.bind(this)),_(document).on("click",this.options.reviewsPageSwitcher,function(e){var t="data-product-id",e=_(e.currentTarget).attr(t),e=_("["+t+"="+e+"]");_("["+t+"]").removeClass("active"),e.addClass("active")}.bind(this))},_reloadQuiz:function(){this._triggerQuizContainerVisibility(!1),this._triggerProgressBarVisibility(!1),this._getParent().html(""),this._loadQuiz()},_setQuizTime:function(){var e=6e4*+(r.quizTimeMinutes||2);this.quizTime=setTimeout(function(){this._reloadQuiz()}.bind(this),e)},_triggerQuizContainerVisibility:function(e){this._getParent().toggle(e)},_triggerQuizWrapperVisibility:function(e){_("."+r.quizWrapper).toggle(e)},_triggerLearnMoreVisibility:function(e){_("body").toggleClass("quiz-body-overflowed",e),_("."+this.options.learnMoreClass).toggle(e)},_triggerGetStartedVisibility:function(e){_("."+this.options.getStartedContainerClass).toggle(e)},_triggerFooterParagraphVisibility:function(e){_("."+this.options.getFooterContainerClass).toggle(e)},_triggerFormVisibility:function(e){_("body").toggleClass("quiz-body-overflowed",e),_("."+this.options.formWrapperClass).toggle(e)},_triggerProgressBarVisibility:function(e){_("."+this.options.progressBarWrapperClass).toggle(e)},_beginQuiz:function(){this._triggerQuizContainerVisibility(!0),this._triggerProgressBarVisibility(!0),this._triggerGetStartedVisibility(!1),this._triggerFooterParagraphVisibility(!1),this._updateProgressBar(),window.dataLayer.push({event:"started_sleep_selector"})}};r&&e._create(),window.quizWidget=e}function incertGTM(){var e=window,t=document,i="dataLayer";e[i]=e[i]||[],e[i].push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),e=t.getElementsByTagName("script")[0],(i=t.createElement("script")).async=!0,i.src=" https://www.googletagmanager.com/gtm.js?id=GTM-5F7CN2V",e.parentNode.insertBefore(i,e)}function incertUserIPDetector(){window.geoip=e=>{window.userCity=e.city,window.userIp=e.ip,window.userCountry=e.country};var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","https://get.geojs.io/v1/ip/geo.js"),(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(e)}!function(){var o,e;function t(){o=window.jQuery.noConflict(!0),i()}function i(){var e=window,t=document,i="qp",s=void 0,r=void 0,a=document.querySelectorAll("A[quiz],DIV[quiz],A[data-quiz],DIV[data-quiz]");if(a&&a.length)for(var n=0;n<a.length;n++)a[n].id="quiz-embed-"+n,a[n].href="javascript:var i=document.getElementById('quiz-embed-"+n+"');try{qz.startQuiz(i)}catch(e){i.start=1;i.style.cursor='wait';i.style.opacity='0.5'};void(0);";e.QP=i,e.qp=e.qp||function(){(e.qp.q=e.qp.q||[]).push(arguments)},e.qp.l=+new Date,s=t.createElement("script"),r=t.getElementsByTagName("script")[0],s.async=1,s.src="https://take.quiz-maker.com/3012/CDN/quiz-embed-v1.js",s.readyState?s.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||quizWidget(o)}:s.onload=function(){quizWidget(o)},r.parentNode.insertBefore(s,r)}incertUserIPDetector(),incertGTM(),void 0===window.jQuery||"3.6.0"!==window.jQuery.fn.jquery?((e=document.createElement("script")).setAttribute("type","text/javascript"),e.setAttribute("src","https://code.jquery.com/jquery-3.6.0.min.js"),e.readyState?e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||t()}:e.onload=t,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(e)):(o=window.jQuery,i())}();